<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • rctbayespower</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">rctbayespower</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/01-introduction.html">Getting Started with 'rctbayespower'</a></li>
    <li><a class="dropdown-item" href="articles/02-prior-specification.html">Prior Specifications in 'rctbayespower'</a></li>
    <li><a class="dropdown-item" href="articles/03-algorithm-performance.html">Comparative Algorithm Performance in 'rctbayespower'</a></li>
    <li><a class="dropdown-item" href="articles/99-model-validation.html">Model Validation for Predefined Models in 'rctbayespower'</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/matthiaskloft/rctbayespower/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/matthiaskloft/rctbayespower/blob/HEAD/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="project-overview">Project Overview<a class="anchor" aria-label="anchor" href="#project-overview"></a></h2>
<p><code>rctbayespower</code> is an R package for conducting Bayesian power analysis for randomized controlled trials (RCTs) using <code>brms</code> and Stan. The package provides tools for estimating power curves, determining optimal sample sizes, and incorporating prior knowledge about treatment effects using region of practical equivalence (ROPE) for decision making.</p>
</div>
<div class="section level2">
<h2 id="current-status-updated---2025-07-21">Current Status (Updated - 2025-07-21)<a class="anchor" aria-label="anchor" href="#current-status-updated---2025-07-21"></a></h2>
<p><strong>Core Package State: Functional and stable core with documentation lag</strong></p>
<p><strong>✅ IMPLEMENTED FEATURES - Object-Oriented API:</strong></p>
<p><strong>Core Functions (100% Complete &amp; Working):</strong> - <strong><code><a href="reference/build_model.html">build_model()</a></code></strong> - Create model specifications for power analysis - <strong><code><a href="reference/build_design.html">build_design()</a></code></strong> - Create experimental design configurations - <strong><code><a href="reference/build_conditions.html">build_conditions()</a></code></strong> - Generate analysis conditions from design parameters - <strong><code><a href="reference/simulate_single_run.html">simulate_single_run()</a></code></strong> - Execute single simulation run for power analysis</p>
<p><strong>Pre-built Models:</strong> - <strong><code>build_model("ancova_cont_2arms")()</code></strong> - ANCOVA model for continuous outcomes ✅ - <strong>To Do</strong>: <code><a href="reference/build_model_ancova.html">build_model_ancova()</a></code> as generalized version with wrappers for specific defaults</p>
<p><strong>Advanced Features (100% Complete):</strong> - <strong>Design Prior Integration</strong> - Supports brms syntax with comprehensive fallback hierarchy - <strong>Integrated Power Computation</strong> - Weighted power across effect sizes using priors - <strong>Sophisticated Parallelization</strong> - Robust parallel processing with parameter preservation - <strong>Comprehensive Plotting</strong> - Multiple visualization types with auto-detection - <strong>Model Caching</strong> - Significant performance improvements for grid analyses</p>
<p><strong>S3 Methods (100% Complete):</strong> - <code>plot.rctbayespower_sim_result()</code> - Visualization of power analysis results - <code>print.rctbayespower_*()</code> methods for all object types</p>
<p><strong>⚠️ INCOMPLETE FEATURES:</strong></p>
<p><strong>Documentation Inconsistencies (Critical):</strong> - <strong>Vignettes</strong>: Still reference non-existent <code>power_analysis_ancova()</code> function - need complete rewriting - <strong>Manual pages</strong>: Some still reference old function names - <strong>All vignettes need updating</strong> for new API</p>
<p><strong>Test Suite (0% Complete):</strong> - <strong>Status</strong>: All test files contain only TODO comments - <strong>Impact</strong>: No automated testing coverage - <strong>Files</strong>: 4 test files with placeholder content only</p>
<p><strong>Missing Outcome Types:</strong> - <strong>Binary outcomes</strong> - Referenced in old docs but never implemented - <strong>Count outcomes</strong> - Referenced in old docs but never implemented</p>
<p><strong>Current Production-Ready Workflow:</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Create model → 2. Create design → 3. Create conditions → 4. Run analysis</span></span>
<span><span class="va">model_ancova</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/build_model.html">build_model</a></span><span class="op">(</span><span class="st">"ancova_cont_2arms"</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/build_design.html">build_design</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">target_params</span>, <span class="va">thresholds</span>, <span class="va">p_sig</span><span class="op">)</span></span>
<span><span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/build_conditions.html">build_conditions</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">condition_values</span>, <span class="va">static_values</span><span class="op">)</span></span>
<span><span class="va">power_config</span> <span class="op">&lt;-</span> <span class="fu">rctbp_power_analysis</span><span class="op">(</span>conditions <span class="op">=</span> <span class="va">conditions</span>, n_cores <span class="op">=</span> <span class="va">n_cores</span>, n_sims <span class="op">=</span> <span class="va">n_sims</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="va">power_config</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="development-practices-and-r-cmd-check-guidelines">Development Practices and R CMD Check Guidelines<a class="anchor" aria-label="anchor" href="#development-practices-and-r-cmd-check-guidelines"></a></h2>
<div class="section level3">
<h3 id="documentation-guidelines">Documentation Guidelines<a class="anchor" aria-label="anchor" href="#documentation-guidelines"></a></h3>
<ul><li><strong>Always update documentations directly in the .R file’s roxygen documentation</strong></li>
<li>
<strong>CRITICAL</strong>: After updating roxygen comments, run <code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document()</a></code> to regenerate .Rd files</li>
<li>
<strong>Never manually edit .Rd files</strong> in the <code>man/</code> directory - they are auto-generated</li>
<li>Only edit the README.Rmd file, the README.md file will get build from it later.</li>
</ul></div>
<div class="section level3">
<h3 id="documentation-best-practices">Documentation Best Practices<a class="anchor" aria-label="anchor" href="#documentation-best-practices"></a></h3>
<ul><li>
<strong>Concise Example Guidelines</strong>:
<ul><li>Examples in the documentation of a function need to be as short and concise as possible</li>
<li>Only one variant of the function should be demonstrated if the function has extended run time</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="r-cmd-check-best-practices">R CMD Check Best Practices<a class="anchor" aria-label="anchor" href="#r-cmd-check-best-practices"></a></h3>
<div class="section level4">
<h4 id="id_1-avoiding-documentation-mismatches">1. Avoiding Documentation Mismatches<a class="anchor" aria-label="anchor" href="#id_1-avoiding-documentation-mismatches"></a></h4>
<p><strong>Problem</strong>: R CMD check fails when default parameter values in code don’t match roxygen documentation.</p>
<p><strong>Solution</strong>: Always ensure roxygen <code>@param</code> documentation matches the actual default values in function signatures.</p>
<p><strong>Example Fix</strong>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># BAD: Code has default = 0.975 but docs say 0.95</span></span>
<span><span class="co">#' @param p_sig_success Probability threshold for success (default 0.95)</span></span>
<span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_sig_success</span> <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span> <span class="op">{</span> <span class="va">...</span> <span class="op">}</span></span>
<span></span>
<span><span class="co"># GOOD: Documentation matches code</span></span>
<span><span class="co">#' @param p_sig_success Probability threshold for success (default 0.975) </span></span>
<span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_sig_success</span> <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span> <span class="op">{</span> <span class="va">...</span> <span class="op">}</span></span></code></pre></div>
<p><strong>Recent fixes applied</strong>: Updated documentation for <code>p_sig_success</code> in <code>power_analysis.R</code>, and class system fixes throughout package.</p>
</div>
</div>
<div class="section level3">
<h3 id="documentation-conventions">Documentation Conventions<a class="anchor" aria-label="anchor" href="#documentation-conventions"></a></h3>
<ul><li>Don’t use  in roxygen docs. Use [functionname()] instead.</li>
</ul></div>
<div class="section level3">
<h3 id="code-writing-guidelines">Code Writing Guidelines<a class="anchor" aria-label="anchor" href="#code-writing-guidelines"></a></h3>
<ul><li>
<strong>Output and Messaging Best Practices</strong>:
<ul><li>Always wrap argument names in quotes when displaying them in printed output such as in stop(), warning(), message(), or documentation. This improves clarity and avoids confusion with actual values or natural language.</li>
</ul></li>
</ul></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthias Kloft.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

